<!DOCTYPE html>
<html lang="en" xmlns:th="https://www.thymeleaf.org/">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/css/fileDropzone.css">
    <!--upload-->
    <script src="https://unpkg.com/dropzone@5/dist/min/dropzone.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/dropzone@5/dist/min/dropzone.min.css" type="text/css"/>
    <title>Admin - Add Room</title>
    <th:block th:insert="fragments/theme :: theme"/>
</head>

<body>
<header th:replace="fragments/header :: header"></header>

<main>
    <div class="container">
        <h1>Add Room</h1>
        <form id="fileDropzone" style="margin-bottom: 10px" method="post" action="/file/upload"
              class="dropzone dz-clickable">
            <div class="dz-default dz-message">
                <div class="dz-icon icon-wrap icon-circle icon-wrap-md">
                    <i class="fa fa-cloud-upload fa-3x"></i>
                </div>
                <div>
                    <p class="dz-text" style="color: #fe7979">please click and upload image or drag image on it</p>
                    <p style="color: #fe7979">However, only one image can be uploaded</p>
                </div>
            </div>
        </form>
        <form method="post" action="/admin/room/add/process_form">
            <p>
                <label for="name">Room Name: </label>
                <!-- Input pattern: Must start with alphanumeric and allow spaces anywhere afterwards. -->
                <input type="text" id="name" name="name" required pattern="([A-Za-z0-9]+)([A-Za-z0-9\s]*)">
                <input id="url" name="url" style="display: none">
            </p>
            <p>
                <input class="btn btn-primary" type="submit" value="Submit">
            </p>
        </form>
        <p th:if="${result}">Successfully added room.</p>
        <p th:if="${result != null && !result}">Failed to add room.</p>
    </div>
</main>

<footer th:replace="fragments/footer :: footer"></footer>
</body>
</html>
<script>
    // upload
    Dropzone.options.fileDropzone = {
        paramName: "file",
        maxFiles: 1,
        maxFilesize: 1000,
        filesizeBase: 1000,
        acceptedFiles: ".bmp,.jpg,.png,.tif,.gif,.svg,.psd,.cdr,.pcd,dxf,ufo,eps,ai,raw,WMF,webp",
        addRemoveLinks: true,
        clickable: true,
        autoProcessQueue: true,
        parallelUploads: 1,
        init: function () {
            this.on("success", function (file, res) {
                document.getElementById("url").value = res.fileDownloadUri
            })
            this.on("removedfile", function (file) {
                JSONData.img = null
            })
            this.on('reset', function () {
                if (this.files.length !== 0) {
                    for (let i = 0; i < this.files.length; i++) {
                        this.files[i].previewElement.remove();
                    }
                    this.files.length = 0;
                }
            });
        }
    };
</script>
